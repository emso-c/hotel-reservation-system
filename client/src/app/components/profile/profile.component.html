<app-dynamic-lottie *ngIf="state.loading"></app-dynamic-lottie>

<div class="d-flex justify-content-center align-items-center" style="min-height: 86.21vh">
  <div class="card">
    <div class="card-header">
      <h3>Profile</h3>
    </div>
    <div class="card-body">
      <form [formGroup]="profileForm">
        <div class="form-group d-flex justify-content-center">
          <app-image-picker [imageUrl]="profilePhoto"
            (newImgEvent)="onImagePicked($event)"></app-image-picker>
        </div>
        <div class="form-group mt-2">
          <label for="username">Username</label>
          <input type="text" class="form-control" id="username" formControlName="username">
        </div>
        <div class="form-group mt-2">
          <label for="email">Email</label>
          <input type="email" class="form-control" id="email" formControlName="email">
        </div>
        <div class="form-group mt-2">
          <label for="password">Password</label>
          <input type="password" class="form-control" id="password" formControlName="password">
        </div>
        <div class="form-group mt-2">
          <label for="currPassword">Current Password <small class="form-text text-muted">(required)</small></label>
          <input type="password" class="form-control" id="currPassword" formControlName="currPassword">
          <small class="form-text text-muted">Leave the fields you don't want to update blank</small>
        </div>
        <div class="form-group mt-2">
          <app-form-error
          [control]="profileForm.controls['username']"
          [data]="{
            errorText: 'Invalid username',
            minlength: 'Username must be at least 4 characters',
            maxlength: 'Username must be at most 20 characters',
            pattern: 'Username must contain only letters and numbers'
            }"
          ></app-form-error>
  
          <app-form-error
            [control]="profileForm.controls['password']"
            [data]="{
              errorText: 'Invalid password',
              minlength: 'Password must be at least 8 characters',
              maxlength: 'Password must be at most 20 characters',
              pattern: 'Password must contain at least one lowercase letter, one uppercase letter, and one digit'
            }"
          ></app-form-error>
  
          <app-form-error
            [control]="profileForm.controls['currPassword']"
            [data]="{
              errorText: 'Invalid password',
              required: 'Current password is required'
            }"
          ></app-form-error>

          <app-form-error
            [control]="profileForm.controls['email']"
            [data]="{
              errorText: 'Invalid email',
              email: 'Email must be a valid email address'
            }"
          ></app-form-error>
        </div>
        <div class="form-group d-flex justify-content-center mt-2">
          <button class="btn btn-primary me-2" (click)="updateProfile()">Update</button>
          <button class="btn btn-danger" (click)="deleteProfile()">Delete</button>
        </div>
      </form>
  </div>
</div>